<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/x-icon"><meta content="width=device-width,initial-scale=1,viewport-fit=cover" name="viewport"><meta content="#000000" name="theme-color"><meta content="Marco Cella Blog" name="description"><link href="/manifest.json" rel="manifest"><link href="/logo192.png" rel="apple-touch-icon"><title>Azure App Service with Azure File Share</title><style>@import url(https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap);</style><script type="text/javascript">!function(n){if("/"===n.search[1]){var a=n.search.slice(1).split("&").map(function(n){return n.replace(/~and~/g,"&")}).join("?");window.history.replaceState(null,null,n.pathname.slice(0,-1)+a+n.hash)}}(window.location)</script><script defer src="/static/js/main.88814732.js"></script><link href="/static/css/main.6284e917.css" rel="stylesheet"><link href="https://fonts.googleapis.com" rel="preconnect"><meta content="Azure App Service with Azure File Share" data-react-helmet="true" name="description"><meta content="azure, app-service" data-react-helmet="true" name="keywords"><meta content="Marco Cella" data-react-helmet="true" name="author"><meta content="Azure App Service with Azure File Share" data-react-helmet="true" property="og:title"><meta content="Azure App Service with Azure File Share" data-react-helmet="true" property="og:description"><meta content="website" data-react-helmet="true" property="og:type"><link href="https://fonts.gstatic.com" rel="preconnect"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="App"><div class="light"><div><nav class="sticky top-0 bg-gray-custom1 dark:bg-slate-custom3 flex justify-center"><div class="w-11/12 sm:w-11/12 md:w-9/12 lg:w-8/12 xl:w-6/12 2xl:w-4/12 mx-0 flex justify-left header"><div class="my-4"><span class="text-5xl font-extrabold text-gray-900 dark:text-white1 m-2">mc //connected</span></div><div class="line-break"></div><div class="w-full min-w-full"><div class="float-left"><a href="/blog" data-discover="true"><button type="button" class="text-gray-900 focus:outline-none border-none hover:bg-gray-100 focus:bg-gray-100 font-medium rounded-full text-sm lg:text-base px-3 py-1.5 me-2 mb-2 dark:border-gray-100 dark:hover:bg-gray-100 dark:hover:border-gray-100 dark:text-gray-100 hover:dark:text-gray-900 dark:bg-slate-custom2 false">Blog</button></a><a href="/profile" data-discover="true"><button type="button" class="text-gray-900 focus:outline-none border-none hover:bg-gray-100 focus:bg-gray-100 font-medium rounded-full text-sm lg:text-base px-3 py-1.5 me-2 mb-2 dark:border-gray-100 dark:hover:bg-gray-100 dark:hover:border-gray-100 dark:text-gray-100 hover:dark:text-gray-900 dark:bg-slate-custom2 false">Profile</button></a></div><div class="flex float-right h-full items-center text-gray-900 dark:text-gray-100"><button type="button"><svg class="size-5 mb-2" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div></div></nav></div><div class="flex flex-col items-center content min-h-[calc(100vh-172px)] dark:bg-slate-custom1"><div class="w-11/12 sm:w-11/12 md:w-9/12 lg:w-8/12 xl:w-6/12 2xl:w-4/12 mx-0"><div class="mt-16 mb-4 flex justify-items-start content"><h1 class="font-semibold text-left text-lg lg:text-2xl w-full md:w-full dark:text-gray-custom1">Azure App Service with Azure File Share</h1><div class="line-break"></div><span class="flex items-center"><svg class="h-6 w-6 stroke-orange-400 mr-2 text-gray-custom3 dark:text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-slot="icon"><path d="M6.75 2.994v2.25m10.5-2.25v2.25m-14.252 13.5V7.491a2.25 2.25 0 0 1 2.25-2.25h13.5a2.25 2.25 0 0 1 2.25 2.25v11.251m-18 0a2.25 2.25 0 0 0 2.25 2.25h13.5a2.25 2.25 0 0 0 2.25-2.25m-18 0v-7.5a2.25 2.25 0 0 1 2.25-2.25h13.5a2.25 2.25 0 0 1 2.25 2.25v7.5m-6.75-6h2.25m-9 2.25h4.5m.002-2.25h.005v.006H12v-.006Zm-.001 4.5h.006v.006h-.006v-.005Zm-2.25.001h.005v.006H9.75v-.006Zm-2.25 0h.005v.005h-.006v-.005Zm6.75-2.247h.005v.005h-.005v-.005Zm0 2.247h.006v.006h-.006v-.006Zm2.25-2.248h.006V15H16.5v-.005Z" stroke-linecap="round" stroke-linejoin="round"></path></svg><time class="text-gray-custom2 text-left text-sm lg:text-base w-full md:w-full dark:text-gray-custom4">Aug 20, 2024</time></span><div class="line-break"></div><div class="articleBody"><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">This article covers the Azure File Share mount in Azure App Service resources using different network configuration options.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">Azure App Service is a fully managed PaaS compute solution by Microsoft Azure designed to host web applications on the Azure platform. Azure App Service supports many runtime stacks: .NET, ASP.NET, Java, Node.js, PHP, Python, and different publishing models: Code, Container, Static Web App.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">Your web application hosted in the Azure App Service might need to persist data, access a shared storage, or interact with existing systems. Azure App Service allows you to mount Azure File Shares and Azure Blob Storages as network shares. In this post I am going to focus on the Azure File Share as a network share for the Azure App Service.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">The network configuration of the Azure resources is extremely important in order to establish the communication between the Azure App Service and the Azure Storage Account. An incorrect network configuration will cause the web application to fail to start. The following is an error listed in the Azure App Service logs when the Azure App Service is not able to mount the File Share:</p><p class="bg-blue-100 dark:bg-blue-900 border-blue-500 text-blue-700 dark:text-blue-100 leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert px-4 py-2">Volume: BYOS_FILES_share cannot be mounted at /mnt/share during container: app-appservice-prod-weu-001_kudu startup. The volume mount is required. Terminate.<br>Container start up failed with reason: VolumeMountFailure. Revert by terminate.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">In the following sections, I will describe some network configurations that can be applied to the Azure resources, ranging from the most permissive to the most secure approaches. The following constraint is applied: in all of the scenarios, the Azure App Service resource will be configured with Public inbound network access and no restrictions.</p><p class="font-semibold leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">Public Network Access</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">The first approach is to configure the Azure Storage Account with Public Network access enabled from all networks. In this scenario, the Azure App Service communicates with the Azure Storage Account using the public Internet. You can additionally control the access level of the Azure Storage Account, configuring the network rules in the Firewall configuration [2], granting access to the Public IP address(es) of the Azure App Service resource.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">The following is one example project defining this use case:<br><a href="https://github.com/sitMCella/azure-app-service-examples/tree/main/terraform_dotnet_public" class="underline" rel="noreferrer" target="_blank">terraform_dotnet_public</a></p><p class="font-semibold leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">Service Endpoint</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">The second approach consists of configuring the virtual network integration for the Azure App Service resource, and the network rules in the Firewall configuration of the Azure Storage Account.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">The virtual network integration gives your web application access to the resources in the Azure Virtual Network, but it does not grant inbound private access to your web application from the Azure Virtual Network. The virtual network integration feature is available for Azure App Service dedicated compute pricing tiers (Basic, Standard, Premium, PremiumV2, PremiumV3).</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">The Firewall configuration in the Azure Storage Account must be configured to grant access to the subnet used for the VNet integration in the Azure App Service. The Azure documentation [1] specifies that the Storage firewall is supported only through service endpoints and private endpoints (when VNet integration is used). For this scenario, the service endpoint "Microsoft.Web/serverFarms" must be configured in the subnet used for the VNet integration in the Azure App Service.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">The following is one example project defining this use case:<br><a href="https://github.com/sitMCella/azure-app-service-examples/tree/main/terraform_dotnet_service_endpoint" class="underline" rel="noreferrer" target="_blank">terraform_dotnet_service_endpoint</a></p><p class="font-semibold leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">Private Endpoint</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">The third approach consists of configuring the virtual network integration for the Azure App Service resource, and the Private Endpoint for the Azure Storage Account. The Private Endpoint associates a Private IP address to the Azure Storage Account. In addition the Network configuration in the Azure Storage Account must be configured to disable the Public network access.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">The following is one example project defining this use case:<br><a href="https://github.com/sitMCella/azure-app-service-examples/tree/main/terraform_dotnet_private_endpoint" class="underline" rel="noreferrer" target="_blank">terraform_dotnet_private_endpoint</a></p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">From network perspective, in case that a Network Security Group or a firewall are configured to filter the network traffic, remember that the traffic to the ports 80 and 445 should be open in order to mount an Azure File Share in the Azure App Service.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">[1] <a href="https://learn.microsoft.com/en-us/azure/app-service/configure-connect-to-azure-storage?tabs=basic%2Cportal&pivots=container-linux" class="underline" rel="noreferrer" target="_blank">configure-connect-to-azure-storage</a><br>[2] <a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-network-security?tabs=azure-portal" class="underline" rel="noreferrer" target="_blank">storage-network-security</a></p></div></div><div class="mt-8 flex items-center text-left"><svg class="h-5 w-5 stroke-orange-400 mr-1 text-gray-custom3 dark:text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-slot="icon"><path d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6 6h.008v.008H6V6Z" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="m-1 px-1.5 py-0.5 border rounded border-gray-custom3 text-gray-custom2 dark:border-gray-400 dark:text-gray-custom4 text-xs lg:text-sm font-medium text-left text-base prose">azure</span><span class="m-1 px-1.5 py-0.5 border rounded border-gray-custom3 text-gray-custom2 dark:border-gray-400 dark:text-gray-custom4 text-xs lg:text-sm font-medium text-left text-base prose">app-service</span></div></div><div class="mb-16"></div><div></div></div><div><nav class="sticky top-0 bg-gray-custom1 dark:bg-slate-custom3 flex justify-center"><div class="w-11/12 sm:w-11/12 md:w-9/12 lg:w-8/12 xl:w-6/12 2xl:w-4/12 mx-0 flex justify-left header"><div class="w-full min-w-full"><div class="float-left"><div class="my-4"><span><span class="text-gray-900 dark:text-white1 tracking-wide text-sm lg:text-base">© Marco Cella • all rights reserved</span></span></div></div><div class="flex float-right h-full items-center text-gray-900 dark:text-gray-100"><a href="https://www.linkedin.com/in/marco-cella-48391a5b" class="underline mr-2" rel="noreferrer" target="_blank"><svg class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" height="24" stroke-linecap="round" stroke-linejoin="round" width="24"><path d="M0 0h24v24H0z" fill="none" stroke="none"></path><path d="M8 11v5"></path><path d="M8 8v.01"></path><path d="M12 16v-5"></path><path d="M16 16v-3a2 2 0 1 0 -4 0"></path><path d="M3 7a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v10a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4z"></path></svg></a><a href="https://mastodon.social/@marco_cella" class="underline" rel="noreferrer" target="_blank"><svg class="icon icon-tabler icons-tabler-outline icon-tabler-brand-mastodon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" height="24" stroke-linecap="round" stroke-linejoin="round" width="24"><path d="M0 0h24v24H0z" fill="none" stroke="none"></path><path d="M18.648 15.254c-1.816 1.763 -6.648 1.626 -6.648 1.626a18.262 18.262 0 0 1 -3.288 -.256c1.127 1.985 4.12 2.81 8.982 2.475c-1.945 2.013 -13.598 5.257 -13.668 -7.636l-.026 -1.154c0 -3.036 .023 -4.115 1.352 -5.633c1.671 -1.91 6.648 -1.666 6.648 -1.666s4.977 -.243 6.648 1.667c1.329 1.518 1.352 2.597 1.352 5.633s-.456 4.074 -1.352 4.944z"></path><path d="M12 11.204v-2.926c0 -1.258 -.895 -2.278 -2 -2.278s-2 1.02 -2 2.278v4.722m4 -4.722c0 -1.258 .895 -2.278 2 -2.278s2 1.02 2 2.278v4.722"></path></svg></a></div></div></div></nav></div></div></div></div></body></html>