<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/x-icon"><meta content="width=device-width,initial-scale=1,viewport-fit=cover" name="viewport"><meta content="#000000" name="theme-color"><meta content="Marco Cella Blog" name="description"><link href="/manifest.json" rel="manifest"><link href="/logo192.png" rel="apple-touch-icon"><title>Web Applications with Clojure</title><style>@import url(https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap);</style><script type="text/javascript">!function(n){if("/"===n.search[1]){var a=n.search.slice(1).split("&").map(function(n){return n.replace(/~and~/g,"&")}).join("?");window.history.replaceState(null,null,n.pathname.slice(0,-1)+a+n.hash)}}(window.location)</script><link href="https://fonts.googleapis.com" rel="preconnect"><script defer src="/static/js/main.88814732.js"></script><link href="/static/css/main.6284e917.css" rel="stylesheet"><meta content="Web Applications with Clojure" data-react-helmet="true" name="description"><meta content="story-outline, clojure" data-react-helmet="true" name="keywords"><meta content="Marco Cella" data-react-helmet="true" name="author"><meta content="Web Applications with Clojure" data-react-helmet="true" property="og:title"><meta content="Web Applications with Clojure" data-react-helmet="true" property="og:description"><meta content="website" data-react-helmet="true" property="og:type"><link href="https://fonts.gstatic.com" rel="preconnect"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="App"><div class="light"><div><nav class="sticky top-0 bg-gray-custom1 dark:bg-slate-custom3 flex justify-center"><div class="w-11/12 sm:w-11/12 md:w-9/12 lg:w-8/12 xl:w-6/12 2xl:w-4/12 mx-0 flex justify-left header"><div class="my-4"><span class="text-5xl font-extrabold text-gray-900 dark:text-white1 m-2">mc //connected</span></div><div class="line-break"></div><div class="w-full min-w-full"><div class="float-left"><a href="/blog" data-discover="true"><button type="button" class="text-gray-900 focus:outline-none border-none hover:bg-gray-100 focus:bg-gray-100 font-medium rounded-full text-sm lg:text-base px-3 py-1.5 me-2 mb-2 dark:border-gray-100 dark:hover:bg-gray-100 dark:hover:border-gray-100 dark:text-gray-100 hover:dark:text-gray-900 dark:bg-slate-custom2 false">Blog</button></a><a href="/profile" data-discover="true"><button type="button" class="text-gray-900 focus:outline-none border-none hover:bg-gray-100 focus:bg-gray-100 font-medium rounded-full text-sm lg:text-base px-3 py-1.5 me-2 mb-2 dark:border-gray-100 dark:hover:bg-gray-100 dark:hover:border-gray-100 dark:text-gray-100 hover:dark:text-gray-900 dark:bg-slate-custom2 false">Profile</button></a></div><div class="flex float-right h-full items-center text-gray-900 dark:text-gray-100"><button type="button"><svg class="size-5 mb-2" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div></div></nav></div><div class="flex flex-col items-center content min-h-[calc(100vh-172px)] dark:bg-slate-custom1"><div class="w-11/12 sm:w-11/12 md:w-9/12 lg:w-8/12 xl:w-6/12 2xl:w-4/12 mx-0"><div class="mt-16 mb-4 flex justify-items-start content"><h1 class="font-semibold text-left text-lg lg:text-2xl w-full md:w-full dark:text-gray-custom1">Web Applications with Clojure</h1><div class="line-break"></div><span class="flex items-center"><svg class="h-6 w-6 stroke-orange-400 mr-2 text-gray-custom3 dark:text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-slot="icon"><path d="M6.75 2.994v2.25m10.5-2.25v2.25m-14.252 13.5V7.491a2.25 2.25 0 0 1 2.25-2.25h13.5a2.25 2.25 0 0 1 2.25 2.25v11.251m-18 0a2.25 2.25 0 0 0 2.25 2.25h13.5a2.25 2.25 0 0 0 2.25-2.25m-18 0v-7.5a2.25 2.25 0 0 1 2.25-2.25h13.5a2.25 2.25 0 0 1 2.25 2.25v7.5m-6.75-6h2.25m-9 2.25h4.5m.002-2.25h.005v.006H12v-.006Zm-.001 4.5h.006v.006h-.006v-.005Zm-2.25.001h.005v.006H9.75v-.006Zm-2.25 0h.005v.005h-.006v-.005Zm6.75-2.247h.005v.005h-.005v-.005Zm0 2.247h.006v.006h-.006v-.006Zm2.25-2.248h.006V15H16.5v-.005Z" stroke-linecap="round" stroke-linejoin="round"></path></svg><time class="text-gray-custom2 text-left text-sm lg:text-base w-full md:w-full dark:text-gray-custom4">Aug 30, 2024</time></span><div class="line-break"></div><div class="articleBody"><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">In one of the last projects, I used Clojure as the backend for a web application. I decided to explore Clojure because of the concise and functional approach of the language.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">You can choose between different frameworks and libraries for creating web applications in Clojure. I decided to use the Ring [1], Compojure [2], and Component [3] libraries. For bootstrapping the application, I found extremely helpful the User Manager example project created by Sean Corfield:<br><a href="https://github.com/seancorfield/usermanager-example/blob/develop/src/usermanager/main.clj" class="underline" rel="noreferrer" target="_blank">seancorfield/usermanager-example</a></p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">In this article I will provide an overview of these libraries, and a description of how the libraries work together in a web application.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">Ring provides an abstraction over the HTTP protocol. The HTTP requests and responses are managed via Clojure hashmaps. Some of the basic concepts of the Ring library are handlers, request, response, and middleware. The handlers are functions applied to a request and that produce a response.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">In the following example, the <i>get-projects</i> handler calls the <i>model/get-projects</i> function, that retrieves data from the database. The <i>get-projects</i> handler returns the data in json format:</p><pre class="mt-4 text-left h-58 w-full language-clojure" tabindex="0"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">defn</span> get-projects
  <span class="token string">"Retrieve the projects."</span>
  <span class="token punctuation">[</span>request<span class="token punctuation">]</span>
  <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>projects <span class="token punctuation">(</span><span class="token function">model/get-projects</span>
    <span class="token punctuation">(</span><span class="token keyword">-></span> request
      <span class="token symbol">:application/component</span>
      <span class="token symbol">:database</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token function">json-response</span> projects<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">Middleware are functions that are applied before or after the handler is executed. The User Manager example project makes use of Ring middleware to add functionality to the handlers.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">The purpose of the following middleware is to inject the application component in the request before calling the handler:</p><pre class="mt-4 text-left h-48 w-full language-clojure" tabindex="0"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">defn-</span> add-app-component
  <span class="token punctuation">[</span>handler application<span class="token punctuation">]</span>
  <span class="token punctuation">(</span><span class="token keyword">fn</span> <span class="token punctuation">[</span>req<span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token function">handler</span>
      <span class="token punctuation">(</span><span class="token keyword">assoc</span> req
        <span class="token symbol">:application/component</span>
        application<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">Component is a Clojure framework for managing the lifeycle and the dependencies of software components which have runtime state. Every component implements the lifecycle protocol (start and stop methods), and each one can depend on other components.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">The application component used inside the Ring middleware in the previous example, can be configured with a dependency to the database component:</p><pre class="mt-4 text-left h-92 w-full language-clojure" tabindex="0"><code class="language-clojure"><span class="token punctuation">(</span><span class="token keyword">defrecord</span> Application
  <span class="token punctuation">[</span>config database state<span class="token punctuation">]</span>
  component/Lifecycle
  <span class="token punctuation">(</span><span class="token function">start</span> <span class="token punctuation">[</span>this<span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token keyword">assoc</span> this <span class="token symbol">:state</span> <span class="token string">"Running"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">stop</span> <span class="token punctuation">[</span>this<span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token keyword">assoc</span> this <span class="token symbol">:state</span> <span class="token string">"Stopped"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">defn</span> application-component
  <span class="token punctuation">[</span>config<span class="token punctuation">]</span>
  <span class="token punctuation">(</span><span class="token function">component/using</span>
    <span class="token punctuation">(</span><span class="token function">map->Application</span>
    <span class="token punctuation">{</span><span class="token symbol">:config</span> config<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">[</span><span class="token symbol">:database</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">The handlers will then be able to use the database connection from the application component, injected by the middleware in the request.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">Compojure is a routing library for Ring. The routes defined in Compojure return Ring handler functions. Routes can be combined and evaluated in order.<br>The following is an example of routes:</p><pre class="mt-4 text-left h-42 w-full language-clojure" tabindex="0"><code class="language-clojure"><span class="token punctuation">(</span><span class="token function">defroutes</span> app
  <span class="token punctuation">(</span><span class="token function">GET</span> <span class="token string">"/api/projects"</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token function">wrap</span> <span class="token operator">#</span>'get-projects<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">route/resources</span> <span class="token string">"/"</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">route/not-found</span> <span class="token string">"Not Found"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">In this article I described how the Ring, Compojure, and Component libraries can be combined to create a structured web application in Clojure. I used these frameworks for creating the backend of the story outlining web application:<br><a href="https://github.com/sitMCella/book-advisor" class="underline" rel="noreferrer" target="_blank">github.com/sitMCella/book-advisor</a></p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">The web application makes also use of the next.jdbc library [4] as a Clojure wrapper to access the database.</p><p class="leading-7 mt-4 text-left text-base lg:text-lg prose dark:prose-dark dark:prose-invert w-full">[1] <a href="https://github.com/ring-clojure/ring" class="underline" rel="noreferrer" target="_blank">ring-clojure/ring</a><br>[2] <a href="https://github.com/weavejester/compojure" class="underline" rel="noreferrer" target="_blank">weavejester/compojure</a><br>[3] <a href="https://github.com/stuartsierra/component" class="underline" rel="noreferrer" target="_blank">stuartsierra/component</a><br>[4] <a href="https://github.com/seancorfield/next-jdbc" class="underline" rel="noreferrer" target="_blank">seancorfield/next-jdbc</a></p></div></div><div class="mt-8 flex items-center text-left"><svg class="h-5 w-5 stroke-orange-400 mr-1 text-gray-custom3 dark:text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-slot="icon"><path d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6 6h.008v.008H6V6Z" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="m-1 px-1.5 py-0.5 border rounded border-gray-custom3 text-gray-custom2 dark:border-gray-400 dark:text-gray-custom4 text-xs lg:text-sm font-medium text-left text-base prose">story-outline</span><span class="m-1 px-1.5 py-0.5 border rounded border-gray-custom3 text-gray-custom2 dark:border-gray-400 dark:text-gray-custom4 text-xs lg:text-sm font-medium text-left text-base prose">clojure</span></div></div><div class="mb-16"></div><div></div></div><div><nav class="sticky top-0 bg-gray-custom1 dark:bg-slate-custom3 flex justify-center"><div class="w-11/12 sm:w-11/12 md:w-9/12 lg:w-8/12 xl:w-6/12 2xl:w-4/12 mx-0 flex justify-left header"><div class="w-full min-w-full"><div class="float-left"><div class="my-4"><span><span class="text-gray-900 dark:text-white1 tracking-wide text-sm lg:text-base">© Marco Cella • all rights reserved</span></span></div></div><div class="flex float-right h-full items-center text-gray-900 dark:text-gray-100"><a href="https://www.linkedin.com/in/marco-cella-48391a5b" class="underline mr-2" rel="noreferrer" target="_blank"><svg class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" height="24" stroke-linecap="round" stroke-linejoin="round" width="24"><path d="M0 0h24v24H0z" fill="none" stroke="none"></path><path d="M8 11v5"></path><path d="M8 8v.01"></path><path d="M12 16v-5"></path><path d="M16 16v-3a2 2 0 1 0 -4 0"></path><path d="M3 7a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v10a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4z"></path></svg></a><a href="https://mastodon.social/@marco_cella" class="underline" rel="noreferrer" target="_blank"><svg class="icon icon-tabler icons-tabler-outline icon-tabler-brand-mastodon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" height="24" stroke-linecap="round" stroke-linejoin="round" width="24"><path d="M0 0h24v24H0z" fill="none" stroke="none"></path><path d="M18.648 15.254c-1.816 1.763 -6.648 1.626 -6.648 1.626a18.262 18.262 0 0 1 -3.288 -.256c1.127 1.985 4.12 2.81 8.982 2.475c-1.945 2.013 -13.598 5.257 -13.668 -7.636l-.026 -1.154c0 -3.036 .023 -4.115 1.352 -5.633c1.671 -1.91 6.648 -1.666 6.648 -1.666s4.977 -.243 6.648 1.667c1.329 1.518 1.352 2.597 1.352 5.633s-.456 4.074 -1.352 4.944z"></path><path d="M12 11.204v-2.926c0 -1.258 -.895 -2.278 -2 -2.278s-2 1.02 -2 2.278v4.722m4 -4.722c0 -1.258 .895 -2.278 2 -2.278s2 1.02 2 2.278v4.722"></path></svg></a></div></div></div></nav></div></div></div></div></body></html>